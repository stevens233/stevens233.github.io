<!DOCTYPE html>
<html lang="zh-CN">

<!-- <style>
    .noSelect {
        -webkit-touch-callout: none; /* iOS Safari */
        -webkit-user-select: none;   /* Chrome/Safari/Opera */
        -moz-user-select: none;      /* Firefox */
        -ms-user-select: none;       /* Internet Explorer/Edge */
        user-select: none;           /* Non-prefixed version, currently supported by most modern browsers */
    }
</style> -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steven的个人博客</title>
    <link rel="icon" href="/resources/steven.png" type="image/png">
    <link rel="stylesheet" href="/css/style_article.css">
</head>
<script src="script.js"></script>
<body>
    <header>
        <h1>欢迎来到Steven的博客</h1>
        <nav>
            <ul>
                <li><a href="/index.html">首页</a></li>
                <li><a href="/pages/article.html">文章</a></li>
                <li><a href="/pages/about_me.html">关于我</a></li>
                <li><a href="/pages/contact_me.html">联系方式</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section>
            <h2>基于llama_index的rag开发笔记</h2>
            <!-- 文章列表-->
            <article>
                <style type="text/css">
                    .awlist1 {
                        list-style: none;
                        counter-reset: awlistcounter1_0
                    }
                
                    .awlist1>li:before {
                        content: counter(awlistcounter1_0) '.';
                        counter-increment: awlistcounter1_0
                    }
                
                    .awlist2 {
                        list-style: none;
                        counter-reset: awlistcounter1_0 1
                    }
                
                    .awlist2>li:before {
                        content: counter(awlistcounter1_0) '.';
                        counter-increment: awlistcounter1_0
                    }
                </style>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:center; font-size:16pt;"><strong><span style="font-family:宋体;">基于</span></strong><strong>llama_index</strong><strong><span style="font-family:宋体;">的</span></strong><strong>rag</strong><strong><span style="font-family:宋体;">开发笔记</span></strong></p>
                <p style="margin-top:0pt; margin-bottom:0pt;">&nbsp;</p>
                <ol type="1" class="awlist1" style="margin:0pt; padding-left:0pt;">
                    <li style="font-size:12pt; font-weight:bold; list-style-position:inside;"><span style="width:2.71pt; font:7pt 'Times New Roman'; display:inline-block;">&nbsp;&nbsp;</span>rag<span style="font-family:宋体;">：</span></li>
                </ol>
                <p style="margin-top:0pt; margin-bottom:0pt;"><span style="font-family:宋体;">简单来讲，</span>rag<span style="font-family:宋体;">就是通过检索获取相关的知识并将其融入</span>Prompt<span style="font-family:宋体;">，让大模型能够参考相应的知识从而给出合理回答。因此，可以将</span>rag<span style="font-family:宋体;">的核心理解为&ldquo;检索</span>+<span style="font-family:宋体;">生成&rdquo;，前者主要是利用向量数据库的高效存储和检索能力，召回目标知识；后者则是利用大模型和</span>Prompt<span style="font-family:宋体;">工程，将召回的知识合理利用，生成目标答案。</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt;">&nbsp;</p>
                <p style="margin-top:0pt; margin-bottom:0pt;"><span style="font-family:宋体;">数据准备阶段：数据提取&nbsp;</span>&gt;&gt; <span style="font-family:宋体;">文本分割&nbsp;</span>&gt;&gt; <span style="font-family:宋体;">向量化（</span>embedding) &gt;&gt; <span style="font-family:宋体;">数据入库</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt;"><span style="font-family:宋体;">应用阶段：用户提问&nbsp;</span>&gt;&gt; <span style="font-family:宋体;">数据检索（召回）&nbsp;</span>&gt;&gt; <span style="font-family:宋体;">注入</span>Prompt &gt;&gt; LLM<span style="font-family:宋体;">生成答案</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt;">&nbsp;</p>
                <ol start="2" type="1" class="awlist2" style="margin:0pt; padding-left:0pt;">
                    <li style="font-size:12pt; font-weight:bold; list-style-position:inside;"><span style="width:2.71pt; font:7pt 'Times New Roman'; display:inline-block;">&nbsp;&nbsp;</span>llama_index<span style="font-family:宋体;">：</span></li>
                </ol>
                <ol type="1" style="margin:0pt; padding-left:0pt;">
                    <li style="list-style-position:inside;"><span style="font-family:宋体;">开启控制台</span>log<span style="font-family:宋体;">输出</span></li>
                </ol>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">logging</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">basicConfig</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">stream</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">sys</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">stdout</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">,&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">level</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">logging</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">INFO</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">logging</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">getLogger</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">().</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">addHandler</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">logging</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">StreamHandler</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">stream</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">sys</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">stdout</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">))</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">llama_index</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">core</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">set_global_handler</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;simple&quot;</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <ol start="2" type="1" style="margin:0pt; padding-left:0pt;">
                    <li style="list-style-position:inside;"><span style="font-family:宋体;">设置</span>openai<span style="font-family:宋体;">账号与模型</span></li>
                </ol>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">os</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">environ</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">[</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;OPENAI_API_KEY&quot;</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">]&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;xxxxxxxxx&quot;</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">os</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">environ</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">[</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;OPENAI_API_BASE&quot;</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">]&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;urlxxxxxxx&quot;</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#cccccc;">&nbsp;</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">llm</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">OpenAI</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">temperature</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#b5cea8; background-color:#1f1f1f;">0</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">,&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">model</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;gpt-3.5-turbo&quot;</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">,&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">max_tokens</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#b5cea8; background-color:#1f1f1f;">2048</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">Settings</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">llm</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">llm</span></p>
                <ol start="3" type="1" style="margin:0pt; padding-left:0pt;">
                    <li style="list-style-position:inside;"><span style="font-family:宋体;">设置</span>embedding<span style="font-family:宋体;">模型</span></li>
                </ol>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">Settings</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">embed_model</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">HuggingFaceEmbedding</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">model_name</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;BAAI/bge-base-zh-v1.5&quot;</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <ol start="4" type="1" style="margin:0pt; padding-left:0pt;">
                    <li style="list-style-position:inside;"><span style="font-family:宋体;">设置</span>qa prompt<span style="font-family:宋体;">与</span>refine prompt</li>
                </ol>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">qa_prompt</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;(</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;We have provided context information below.&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d7ba7d; background-color:#1f1f1f;">\n</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;----------------</span><span style="font-family:Menlo; font-size:12pt; color:#d7ba7d; background-color:#1f1f1f;">\n</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;context:</span><span style="font-family:Menlo; font-size:12pt; color:#d7ba7d; background-color:#1f1f1f;">\n</span><span style="font-family:Menlo; font-size:12pt; color:#569cd6; background-color:#1f1f1f;">{context_str}</span><span style="font-family:Menlo; font-size:12pt; color:#d7ba7d; background-color:#1f1f1f;">\n</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;----------------</span><span style="font-family:Menlo; font-size:12pt; color:#d7ba7d; background-color:#1f1f1f;">\n</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;你想要定义的prompt&quot;</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;问题:</span><span style="font-family:Menlo; font-size:12pt; color:#569cd6; background-color:#1f1f1f;">{query_str}</span><span style="font-family:Menlo; font-size:12pt; color:#d7ba7d; background-color:#1f1f1f;">\n</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">qa_prompt_tmpl</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">PromptTemplate</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">qa_prompt</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">,&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">prompt_type</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">PromptType</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#4fc1ff; background-color:#1f1f1f;">QUESTION_ANSWER</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#cccccc;">&nbsp;</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">---------------</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#cccccc;">&nbsp;</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">refine_prompt_tmpl</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">PromptTemplate</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">refine_prompt</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">,&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">prompt_type</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">PromptType</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#4fc1ff; background-color:#1f1f1f;">REFINE</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <ol start="5" type="1" style="margin:0pt; padding-left:0pt;">
                    <li style="list-style-position:inside;"><span style="font-family:宋体;">自定义</span>sentence splitter</li>
                </ol>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#569cd6; background-color:#1f1f1f;">class</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">CustomSentenceSplitter</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">SentenceSplitter</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">):</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#569cd6; background-color:#1f1f1f;">def</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">_split_text</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">self</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">,&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">text</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">:&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">str</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">,&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">chunk_size</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">:&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">int</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">) -&gt;&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">List</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">[</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">str</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">]:</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#c586c0; background-color:#1f1f1f;">return</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">text</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">split</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;</span><span style="font-family:Menlo; font-size:12pt; color:#d7ba7d; background-color:#1f1f1f;">\n\n\n</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#569cd6; background-color:#1f1f1f;">def</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">split_text</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">self</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">,&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">text</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">:&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">str</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">) -&gt;&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">List</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">[</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">str</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">]:</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#c586c0; background-color:#1f1f1f;">return</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">text</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">split</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;</span><span style="font-family:Menlo; font-size:12pt; color:#d7ba7d; background-color:#1f1f1f;">\n\n\n</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <ol start="6" type="1" style="margin:0pt; padding-left:0pt;">
                    <li style="list-style-position:inside;"><span style="font-family:宋体;">创建、存储、引用</span>index</li>
                </ol>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#c586c0; background-color:#1f1f1f;">if</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#569cd6; background-color:#1f1f1f;">not</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">os</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">path</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">exists</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">storage_path</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">):</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">splitter</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">CustomSentenceSplitter</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">()</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">documents</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">SimpleDirectoryReader</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;./data/&quot;</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">).</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">load_data</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">()</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">nodes</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">splitter</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">get_nodes_from_documents</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">documents</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">index</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">VectorStoreIndex</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">nodes</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)&nbsp;</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">index</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">storage_context</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">persist</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">persist_dir</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">storage_path</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#c586c0; background-color:#1f1f1f;">else</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">:</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">storage_context</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">StorageContext</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">from_defaults</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">persist_dir</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">storage_path</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">index</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">load_index_from_storage</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">storage_context</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <ol start="7" type="1" style="margin:0pt; padding-left:0pt;">
                    <li style="list-style-position:inside;"><span style="font-family:宋体;">创建</span>retriver<span style="font-family:宋体;">与</span>query engine</li>
                </ol>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">retriever</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">VectorIndexRetriever</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">index</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">index</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">,</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">node_ids</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">list</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">index</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">index_struct</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">nodes_dict</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">values</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">()),</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">callback_manager</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">index</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">_callback_manager</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">,</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">object_map</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">index</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">_object_map</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">,</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">similarity_top_k</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#b5cea8; background-color:#1f1f1f;">5</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">query_engine</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#4ec9b0; background-color:#1f1f1f;">RetrieverQueryEngine</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">from_args</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">retriever</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">,</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">llm</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">llm</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">,&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">response_mode</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;simple_summarize&quot;</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <ol start="8" type="1" style="margin:0pt; padding-left:0pt;">
                    <li style="list-style-position:inside;"><span style="font-family:宋体;">使用</span>retriever<span style="font-family:宋体;">进行检索</span></li>
                </ol>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">prod_retrieve_result</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">prod_retriever</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">retrieve</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">question</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">prod_total_result</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">+=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#569cd6; background-color:#1f1f1f;">f</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;产品编号</span><span style="font-family:Menlo; font-size:12pt; color:#569cd6; background-color:#1f1f1f;">{</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">prod_id</span><span style="font-family:Menlo; font-size:12pt; color:#569cd6; background-color:#1f1f1f;">}</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">的产品文档内容:&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d7ba7d; background-color:#1f1f1f;">\n</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">prod_total_result</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">+=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;</span><span style="font-family:Menlo; font-size:12pt; color:#d7ba7d; background-color:#1f1f1f;">\n</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">----------</span><span style="font-family:Menlo; font-size:12pt; color:#d7ba7d; background-color:#1f1f1f;">\n</span><span style="font-family:Menlo; font-size:12pt; color:#ce9178; background-color:#1f1f1f;">&quot;</span></p>
                <ol start="9" type="1" style="margin:0pt; padding-left:0pt;">
                    <li style="list-style-position:inside;"><span style="font-family:宋体;">使用</span>query engine<span style="font-family:宋体;">进行检索与回答</span></li>
                </ol>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">response</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">query_engine</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">query</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">question</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt; text-align:left; line-height:18pt; widows:2; orphans:2; background-color:#1f1f1f;"><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">response</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#d4d4d4; background-color:#1f1f1f;">=</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">&nbsp;</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">Settings</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">llm</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">.</span><span style="font-family:Menlo; font-size:12pt; color:#dcdcaa; background-color:#1f1f1f;">complete</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">(</span><span style="font-family:Menlo; font-size:12pt; color:#9cdcfe; background-color:#1f1f1f;">pd2_prompt</span><span style="font-family:Menlo; font-size:12pt; color:#cccccc; background-color:#1f1f1f;">)</span></p>
                <ol start="10" type="1" style="margin:0pt; padding-left:0pt;">
                    <li style="list-style-position:inside;"><span style="font-family:宋体;">高级</span>rag<span style="font-family:宋体;">（检索路由、融合检索、关键词检索等）</span></li>
                </ol>
                <p style="margin-top:0pt; margin-bottom:0pt;"><span style="font-family:宋体;">通过精准检索或者目录检索得到对应内容或者</span>index<span style="font-family:宋体;">，再利用</span>embedding<span style="font-family:宋体;">后的问题进行检索，可以增加检索效率，减少误差空间。</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt;"><span style="font-family:宋体;">将检索关键片段与文本长文一同加入</span>prompt<span style="font-family:宋体;">，融合两者使</span>llm<span style="font-family:宋体;">能够理解片段的详细信息与长文的上下关系。</span></p>
                <p style="margin-top:0pt; margin-bottom:0pt;"><span style="font-family:宋体;">先通过关键词检索到对应的</span>index<span style="font-family:宋体;">，再通过</span>index<span style="font-family:宋体;">进行二次检索，从而得到理想的内容。</span></p>
            </article>
            <!-- 更多文章-->
        </section>
    </main>

    <footer>
        <p>版权所有 &copy; 2024 Steven的博客</p>
    </footer>

</body>
</html>